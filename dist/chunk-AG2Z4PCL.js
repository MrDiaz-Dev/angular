import{a as de,b as ue}from"./chunk-PT33TCTM.js";import{a as pe}from"./chunk-7XMPM6XI.js";import{a as me,b as ge}from"./chunk-BEGGZART.js";import{a as ce}from"./chunk-EBAT4PEW.js";import"./chunk-XEDJVIF6.js";import{a as le}from"./chunk-RWJF4HFR.js";import{a as A}from"./chunk-AWRCIJRC.js";import{a as R}from"./chunk-DYKERIVD.js";import{a as re}from"./chunk-FKGF6V4I.js";import{C as ie,E as oe,I as ae,O as ne,T as se,V as E,s as k}from"./chunk-VCJMVCMV.js";import"./chunk-UVXM5JHS.js";import{n as Y,z as Z}from"./chunk-D74LBUZY.js";import{A as $,D as ee,E as te,q as Q,y as X}from"./chunk-UFTRMQMS.js";import{Gb as G,Hb as p,Ib as K,Jb as w,K as U,Lb as L,Mb as y,Nb as M,O as q,Oa as s,Pb as B,Qb as _,U as d,Y as j,Z as D,Za as h,_a as J,eb as x,ga as z,gb as u,ia as m,ja as g,jb as f,lb as v,pa as N,qa as O,qb as r,rb as a,sb as b,tc as C,uc as T,v as H,wb as S,xb as V,yb as l,z as F}from"./chunk-ALXFD6NA.js";import"./chunk-CWTPBX7D.js";function W(i,c){let e=!c?.manualCleanup;e&&!c?.injector&&z(W);let o=e?c?.injector?.get(N)??d(N):null,t;c?.requireSync?t=h({kind:0}):t=h({kind:1,value:c?.initialValue});let n=i.subscribe({next:P=>t.set({kind:1,value:P}),error:P=>{if(c?.rejectErrors)throw P;t.set({kind:2,error:P})}});return o?.onDestroy(n.unsubscribe.bind(n)),C(()=>{let P=t();switch(P.kind){case 1:return P.value;case 2:throw P.error;case 0:throw new U(601,"`toSignal()` called with `requireSync` but `Observable` did not emit synchronously.")}})}var fe=()=>({width:"100%",maxWidth:"270px",aspectRatio:"1",borderRadius:"10%",objectFit:"cover",boxShadow:"0 0 5px 0 rgba(0, 0, 0, 0.2)"}),I=()=>({width:"-webkit-fill-available"}),be=(()=>{class i{constructor(){this.fechaService=d(A),this.datosPersonales=J(),this.datosComunesIdTipo=O(),this.datosComunesIdTipoMessagePrevValue=[],this.bajaMedicaActual=O(),this.bajaMedicaActualMessagePrevValue=[],this.tituloSituacionLaboralActualPMessage=C(()=>{if(!this.datosComunesIdTipo())return this.datosComunesIdTipoMessagePrevValue;let e=[{severity:"info",summary:`${this.datosComunesIdTipo().idCategoria.nombre}`,detail:this.datosComunesIdTipo().nombre==this.datosComunesIdTipo().idCategoria.nombre?"":this.datosComunesIdTipo().nombre,icon:"pi pi-briefcase"}];return JSON.stringify(e)===JSON.stringify(this.datosComunesIdTipoMessagePrevValue)?this.datosComunesIdTipoMessagePrevValue:(this.datosComunesIdTipoMessagePrevValue=e,e)}),this.bajaMedicaActualPMessage=C(()=>{if(!this.bajaMedicaActual())return this.bajaMedicaActualMessagePrevValue;let e=[{severity:"error",summary:"Baja m\xE9dica activa:",detail:`Desde ${this.fechaService.formatFecha(this.bajaMedicaActual())}`,icon:"pi pi-exclamation-circle"}];return JSON.stringify(e)===JSON.stringify(this.bajaMedicaActualMessagePrevValue)?this.bajaMedicaActualMessagePrevValue:(this.bajaMedicaActualMessagePrevValue=e,e)})}cargarFotografiaURL(){return this.datosPersonales()?.fotografia?R.STORAGE_URL+this.datosPersonales()?.fotografia:"assets/images/notImage.png"}static{this.\u0275fac=function(o){return new(o||i)}}static{this.\u0275cmp=D({type:i,selectors:[["app-cabecera-datos-personales"]],inputs:{datosPersonales:[j.SignalBased,"datosPersonales"],datosComunesIdTipo:[j.SignalBased,"datosComunesIdTipo"],bajaMedicaActual:[j.SignalBased,"bajaMedicaActual"]},outputs:{datosPersonales:"datosPersonalesChange"},standalone:!0,features:[B],decls:40,vars:29,consts:[[1,"grid"],[1,"col-12","grid","pb-0",2,"width","-webkit-fill-available"],[1,"col-12","md:col-4","xl:col-3","pb-0","flex","align-items-center","justify-content-center"],[1,"flex","flex-column","justify-content-center","mx-4",2,"min-height","230px","min-width","190px"],["alt","avatar","showTransitionOptions","0ms","loading","lazy",1,"rounded","float-right","img-thumbnail","img-fluid",3,"src","imageStyle","preview","pTooltip"],[1,"col-12","md:col-8","pb-0","mt-3","md:mt-0"],[1,"w-full","h-full","flex","align-items-center"],[1,"w-full"],[1,"field","grid"],["for","nombre",1,"col-fixed","custom-col-fixed-cabecera-label"],[1,"col-fixed","custom-col-fixed-cabecera-value-text"],["id","nombre"],["for","apellido1",1,"col-fixed","custom-col-fixed-cabecera-label"],["id","apellido1"],["for","apellido2",1,"col-fixed","custom-col-fixed-cabecera-label"],["id","apellido2"],["for","dniNie",1,"col-fixed","custom-col-fixed-cabecera-label"],["id","dniNie"],["for","numeroTarjeta",1,"col-fixed","custom-col-fixed-cabecera-label"],["id","numeroTarjeta"],["styleClass","titulo-situacion","showTransitionOptions","0ms",3,"value","closable"]],template:function(o,t){o&1&&(r(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3),b(4,"p-image",4),a()(),r(5,"div",5)(6,"div",6)(7,"div",7)(8,"div",8)(9,"label",9),p(10," Nombre "),a(),r(11,"div",10)(12,"span",11),p(13),a()()(),r(14,"div",8)(15,"label",12),p(16," 1er apellido "),a(),r(17,"div",10)(18,"span",13),p(19),a()()(),r(20,"div",8)(21,"label",14),p(22," 2do apellido "),a(),r(23,"div",10)(24,"span",15),p(25),a()()(),r(26,"div",8)(27,"label",16),p(28," DNI "),a(),r(29,"div",10)(30,"span",17),p(31),a()()(),r(32,"div",8)(33,"label",18),p(34," Numero Tarjeta "),a(),r(35,"div",10)(36,"span",19),p(37),a()()(),b(38,"p-messages",20)(39,"p-messages",20),a()()()()()),o&2&&(s(4),u("src",t.cargarFotografiaURL())("imageStyle",_(23,fe))("preview",!0)("pTooltip",t.cargarFotografiaURL()==="assets/images/notImage.png"?"No hay imagen del personal":"Ver imagen del personal"),s(8),f(_(24,I)),s(),w(" ",t.datosPersonales().nombre," "),s(5),f(_(25,I)),s(),w(" ",t.datosPersonales().apellido1," "),s(5),f(_(26,I)),s(),w(" ",t.datosPersonales().apellido2," "),s(5),f(_(27,I)),s(),w(" ",t.datosPersonales().dniNie," "),s(5),f(_(28,I)),s(),w(" ",t.datosPersonales().numeroTarjeta," "),s(),u("value",t.tituloSituacionLaboralActualPMessage())("closable",!1),s(),u("value",t.bajaMedicaActualPMessage())("closable",!1))},dependencies:[E,ie,k,ne],encapsulation:2})}}return i})();var _e=(()=>{class i{constructor(){this.http=d(Q),this.API_URL=R.API_URL}get(){let e=this.API_URL+"/datos-tics";return this.http.get(e)}getById(e){let o=this.API_URL+`/datos-tics/${e}`;return this.http.get(o)}getEmailCNB(e){return new Promise(o=>{this.getById(e).subscribe({next:t=>{o(t.emailCnb)},error:t=>{o("")}})})}edit(e,o){let t=this.API_URL+`/datos-tics/${e}`;return this.http.put(t,o)}static{this.\u0275fac=function(o){return new(o||i)}}static{this.\u0275prov=q({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})();var Pe=()=>({position:"sticky",top:"5rem",background:"var(--surface-ground)",zIndex:10,paddingTop:"0.5rem"}),xe=()=>({width:"2rem",height:"100%"});function ve(i,c){i&1&&b(0,"p-progressSpinner",9),i&2&&f(_(2,xe))}function ye(i,c){if(i&1){let e=S();r(0,"div",5)(1,"p-button",6),V("onClick",function(){m(e);let t=l();return g(t.back())}),a(),r(2,"h3",7),p(3),a(),x(4,ve,1,3,"p-progressSpinner",8),a()}if(i&2){let e=l();s(3),K(e.titulo()),s(),v(4,e.submitLoading()?4:-1)}}function Se(i,c){if(i&1){let e=S();b(0,"p-button",10)(1,"p-button",11)(2,"p-button",12)(3,"p-button",13),r(4,"p-button",14),V("onClick",function(){m(e);let t=l();return g(t.cargarDatos())}),a(),r(5,"p-button",15),V("click",function(t){m(e),l();let n=G(1);return g(n.toggle(t))}),a()}if(i&2){let e=l();u("routerLink","/personal/datos-personales/"+e.idPersona())("outlined",e.page()!==1),s(),u("routerLink","/personal/datos-laborales/"+e.idPersona())("outlined",e.page()!==2),s(),u("routerLink","/personal/situacion-laboral/"+e.idPersona())("outlined",e.page()!==3),s(),u("routerLink","/personal/plantillas/"+e.idPersona())("outlined",e.page()!==4)}}function we(i,c){if(i&1){let e=S();r(0,"app-cabecera-datos-personales",16),M("datosPersonalesChange",function(t){m(e);let n=l(2);return y(n.datosPersonales,t)||(n.datosPersonales=t),g(t)}),a(),b(1,"hr")(2,"br")}if(i&2){let e=l(2);L("datosPersonales",e.datosPersonales),u("datosComunesIdTipo",e.datosComunes().idTipo)("bajaMedicaActual",e.bajaMedicaActual())}}function Te(i,c){if(i&1){let e=S();r(0,"app-datos-personales",18),M("datosPersonalesChange",function(t){m(e);let n=l(3);return y(n.datosPersonales,t)||(n.datosPersonales=t),g(t)})("submitLoadingChange",function(t){m(e);let n=l(3);return y(n.submitLoading,t)||(n.submitLoading=t),g(t)}),a()}if(i&2){let e=l(3);L("datosPersonales",e.datosPersonales)("submitLoading",e.submitLoading)}}function Le(i,c){if(i&1&&x(0,Te,1,2,"app-datos-personales",17),i&2){let e=l(2);v(0,e.datosPersonales()?0:-1)}}function Me(i,c){if(i&1){let e=S();r(0,"app-datos-comunes",20),M("datosComunesChange",function(t){m(e);let n=l(3);return y(n.datosComunes,t)||(n.datosComunes=t),g(t)})("submitLoadingChange",function(t){m(e);let n=l(3);return y(n.submitLoading,t)||(n.submitLoading=t),g(t)}),a()}if(i&2){let e=l(3);L("datosComunes",e.datosComunes)("submitLoading",e.submitLoading),u("idPersona",e.idPersona())("mailCNB",e.mailCNB())}}function Ie(i,c){if(i&1&&x(0,Me,1,4,"app-datos-comunes",19),i&2){let e=l(2);v(0,e.datosComunes()?0:-1)}}function je(i,c){if(i&1){let e=S();r(0,"app-situacion-laboral",22),M("situacionLaboralChange",function(t){m(e);let n=l(3);return y(n.situacionLaboral,t)||(n.situacionLaboral=t),g(t)})("submitLoadingChange",function(t){m(e);let n=l(3);return y(n.submitLoading,t)||(n.submitLoading=t),g(t)}),a()}if(i&2){let e=l(3);L("situacionLaboral",e.situacionLaboral)("submitLoading",e.submitLoading),u("idPersona",e.idPersona())}}function De(i,c){if(i&1&&x(0,je,1,3,"app-situacion-laboral",21),i&2){let e=l(2);v(0,e.situacionLaboral()?0:-1)}}function Ve(i,c){i&1&&b(0,"app-plantillas")}function Be(i,c){if(i&1&&x(0,we,3,3)(1,Le,1,1)(2,Ie,1,1)(3,De,1,1)(4,Ve,1,0),i&2){let e,o=l();v(0,o.datosPersonales()&&o.datosComunes()&&o.page()!==1?0:-1),s(),v(1,(e=o.page())===1?1:e===2?2:e===3?3:e===4?4:-1)}}function Re(i,c){i&1&&(r(0,"div",23),b(1,"p-progressSpinner"),a())}var wt=(()=>{class i{constructor(){this.router=d(ee),this.datosPersonalesService=d(le),this.datosComunesService=d(de),this.trabajadoresService=d(me),this.datosTicService=d(_e),this.messageService=d(re),this.fechaService=d(A),this.title=d(X),this.urlState=W(this.router.events.pipe(H(e=>e instanceof $))),this.idPersona=C(()=>this.urlState()&&this.urlState().url.split("/")[3]?(sessionStorage.setItem("idPersona",this.urlState().url.split("/")[3]),this.urlState().url.split("/")[3]):this.router.url.split("/")[3]?(sessionStorage.setItem("idPersona",this.router.url.split("/")[3]),this.router.url.split("/")[3]):sessionStorage.getItem("idPersona")),this.page=C(()=>this.urlState()?this.urlState().url.includes("datos-personales")?(this.title.setTitle(`RRHH - Datos Personales (${this.idPersona()})`),1):this.urlState().url.includes("datos-laborales")?(this.title.setTitle(`RRHH - Datos Laborales (${this.idPersona()})`),2):this.urlState().url.includes("situacion-laboral")?(this.title.setTitle(`RRHH - Situaci\xF3n Laboral (${this.idPersona()})`),3):(this.title.setTitle(`RRHH - Plantillas (${this.idPersona()})`),4):this.router.url.includes("datos-personales")?(this.title.setTitle(`RRHH - Datos Personales (${this.idPersona()})`),1):this.router.url.includes("datos-laborales")?(this.title.setTitle(`RRHH - Datos Laborales (${this.idPersona()})`),2):this.router.url.includes("situacion-laboral")?(this.title.setTitle(`RRHH - Situaci\xF3n Laboral (${this.idPersona()})`),3):(this.title.setTitle(`RRHH - Plantillas (${this.idPersona()})`),4)),this.titulo=C(()=>this.page()===1?"Datos Personales":this.page()===2?"Datos Laborales":this.page()===3?"Situation Laboral":"Plantillas"),this.datosPersonales=h(null),this.datosComunes=h(null),this.situacionLaboral=h(null),this.submitLoading=h(!1),this.bajaMedicaActual=h(null),this.mailCNB=h(""),this.opciones=h([{label:"Datos personales",icon:"pi pi-user",command:()=>{this.router.navigateByUrl("/personal/datos-personales/"+this.idPersona())}},{label:"Datos Laborales",icon:"pi pi-book",command:()=>{this.router.navigateByUrl("/personal/datos-comunes/"+this.idPersona())}},{label:"Situacion Laboral",icon:"pi pi-briefcase",command:()=>{this.router.navigateByUrl("/personal/situacion-laboral/"+this.idPersona())}},{label:"Plantillas",icon:"pi pi-file-export",command:()=>{this.router.navigateByUrl("/personal/plantillas/"+this.idPersona())}},{label:"Recargar",icon:"pi pi-replay",command:()=>{this.cargarDatos()}}]),this.loading=C(()=>!!this.datosPersonales()||!!this.datosComunes()),this.hiddenTime=null,this.handleVisibilityChange=()=>{document.hidden?this.hiddenTime=Date.now():(this.hiddenTime&&Date.now()-this.hiddenTime>=6e5&&(console.log("La pesta\xF1a estuvo oculta por 10 minutos o m\xE1s"),this.cargarDatos()),this.hiddenTime=null)},T(()=>{this.cargarDatos()},{allowSignalWrites:!0}),T(()=>{console.log("Cambiaron los datos personales",this.datosPersonales()),console.log("------------------------")}),T(()=>{console.log("Cambiaron los datos comunes",this.datosComunes()),console.log("------------------------")}),T(()=>{console.log("Cambiaron la situacion laboral",this.situacionLaboral()),console.log("------------------------")}),document.addEventListener("visibilitychange",this.handleVisibilityChange)}ngOnInit(){console.warn("Modulo de Personal")}cargarDatos(){this.cargarDatosPersonales(),this.cargarDatosComunes(),this.cargarSituacionLaboral(),this.verficarBajaMedicaPresente()}cargarDatosPersonales(){this.datosPersonales.set(null),this.datosPersonalesService.get(this.idPersona()).pipe(F(1)).subscribe({next:e=>{this.datosPersonales.set(e)},error:e=>{console.error(e),this.messageService.error(e.error.message||e.message||"Error desconocido al cargar los datos personales")}})}cargarDatosComunes(){this.datosComunes.set(null),this.datosComunesService.get(this.idPersona()).pipe(F(1)).subscribe({next:e=>{this.datosComunes.set(e),this.cargarEmailCNB()},error:e=>{console.error(e),this.messageService.error(e.error.message||e.message||"Error desconocido al cargar los datos comunes")}})}cargarSituacionLaboral(){this.trabajadoresService.getSituacionActualByIDPersona(this.idPersona()).subscribe({next:e=>{this.situacionLaboral.set(e)},error:e=>{console.error(e),this.messageService.error(e.error.message||e.message||"Error desconocido al cargar la situaci\xF3n laboral")}})}verficarBajaMedicaPresente(){this.datosPersonalesService.getBajaMedicaActual(this.idPersona()).subscribe({next:e=>{console.log("Baja m\xE9dica actual"),console.log(e),e.isBajaMedica?this.bajaMedicaActual.set(e.bajaMedica.fechaInicio):this.bajaMedicaActual.set(null)},error:e=>{console.log(e)}})}cargarEmailCNB(){this.datosTicService.getEmailCNB(this.datosComunes().id).then(e=>{this.mailCNB.set(e)})}back(){let e=sessionStorage.getItem("previousPersonalPage");e?this.router.navigateByUrl(e):this.router.navigate(["/"])}static{this.\u0275fac=function(o){return new(o||i)}}static{this.\u0275cmp=D({type:i,selectors:[["app-personal"]],standalone:!0,features:[B],decls:9,vars:6,consts:[["menu",""],["styleClass","w-9 sm:w-4 lg:w-3 xl:w-2",3,"model","popup"],["styleClass","toolbar-sin-bordes"],["pTemplate","left"],["pTemplate","right"],[1,"my-2","flex","flex-row","align-items-center"],["type","button","icon","pi pi-arrow-left","pTooltip","Volver a la b\xFAsqueda","tooltipPosition","top","styleClass","p-button-rounded mr-2",3,"onClick"],[1,"m-0"],["styleClass","ml-3","strokeWidth","6",3,"style"],["styleClass","ml-3","strokeWidth","6"],["id","noBtnMenu","icon","pi pi-user","label","Datos Personales","pTooltip","Ver datos personales","tooltipPosition","top","styleClass","mr-2",3,"routerLink","outlined"],["id","noBtnMenu","icon","pi pi-book","label","Datos Laborales","pTooltip","Ver datos personales","tooltipPosition","top","styleClass","mr-2",3,"routerLink","outlined"],["id","noBtnMenu","icon","pi pi-briefcase","label","Situacion Laboral","pTooltip","Ver datos personales","tooltipPosition","top","styleClass","mr-2",3,"routerLink","outlined"],["id","noBtnMenu","icon","pi pi-file-export","label","Plantillas","pTooltip","Ver plantillas","tooltipPosition","top","styleClass","mr-2",3,"routerLink","outlined"],["id","noBtnMenu","icon","pi pi-replay","pTooltip","Recargar datos","tooltipPosition","left",3,"onClick"],["id","BtnMenu","icon","pi pi-bars","pTooltip","Opciones","tooltipPosition","left",3,"click"],[3,"datosPersonalesChange","datosPersonales","datosComunesIdTipo","bajaMedicaActual"],[3,"datosPersonales","submitLoading"],[3,"datosPersonalesChange","submitLoadingChange","datosPersonales","submitLoading"],[3,"datosComunes","submitLoading","idPersona","mailCNB"],[3,"datosComunesChange","submitLoadingChange","datosComunes","submitLoading","idPersona","mailCNB"],[3,"situacionLaboral","submitLoading","idPersona"],[3,"situacionLaboralChange","submitLoadingChange","situacionLaboral","submitLoading","idPersona"],[1,"hold-transition","login-page","flex","justify-content-center","align-items-center",2,"height","80dvh"]],template:function(o,t){o&1&&(b(0,"p-menu",1,0),r(2,"div")(3,"p-toolbar",2),x(4,ye,5,2,"ng-template",3)(5,Se,6,8,"ng-template",4),a(),b(6,"hr"),a(),x(7,Be,5,2)(8,Re,2,0)),o&2&&(u("model",t.opciones())("popup",!0),s(2),f(_(5,Pe)),s(5),v(7,t.loading()?7:8))},dependencies:[E,Y,Z,oe,te,k,ae,se,ce,ue,pe,ge,be],styles:["@media (max-width: 1350px){#noBtnMenu[_ngcontent-%COMP%]{display:none}}@media (min-width: 1350px){#BtnMenu[_ngcontent-%COMP%]{display:none}}"]})}}return i})();export{wt as PersonalComponent};
