import{e as u,j as h,m as a,mb as l,p as n,xb as f}from"./chunk-ZOV2UBJC.js";var o={production:!0,dev:!1,API_URL:null,STORAGE_URL:"",AVATAR_URL:"../../../../../assets/img/img_avatar.png"};var c={production:!0,dev:!1,API_URL:null,STORAGE_URL:"",AVATAR_URL:"../../../../../assets/img/img_avatar.png"};var g=(()=>{class r{constructor(t){this.http=t,this.config=null}loadConfig(){return this.fileDir=o.production||o.dev?"assets/config.json":"../../assets/config.json",this.http.get(this.fileDir)}getConfig(){return this.config}get storageUrl(){return this.config?this.config.STORAGE_URL:""}isAllReady(){return console.log("config => ",this.config),console.log("isAllReady => ",!!this.config),this.config!=null}setConfig(t){this.config=t}get apiUrl(){return this.config?this.config.API_URL:""}initializeEnv(){return()=>this.loadConfig().toPromise().then(t=>{this.setConfig(t),o.API_URL=this.apiUrl,c.API_URL=this.apiUrl,o.STORAGE_URL=this.storageUrl,c.STORAGE_URL=this.storageUrl,console.log("envs =>"),console.log(o.API_URL),console.log(c.API_URL)})}static{this.\u0275fac=function(e){return new(e||r)(n(l))}}static{this.\u0275prov=a({token:r,factory:r.\u0275fac,providedIn:"root"})}}return r})();var L=(()=>{class r{constructor(t,e,i){this.http=t,this.router=e,this.envConfigService=i,this.API_URL=o.API_URL,this.ejecutarRefresh=!0,this.intervalID=null,i.initializeEnv(),this.API_URL=i.apiUrl}canDoSomething(){return this.API_URL=this.envConfigService.apiUrl,!!this.API_URL}refreshToken(){if(!this.API_URL)return null;let t=localStorage.getItem("token")||"",e=this.API_URL+"/token/refresh",i={data:{token:t}};return this.http.post(e,i).pipe(h(s=>{console.log("REFRESH TOKEN =>",s),this.SaveStorage(s)}),u(s=>!0))}SaveStorage(t){console.log("Save STORAGE =>",t),console.log("JSON => ",t),console.log("USUARIO => ",t.data),localStorage.setItem("token",t.token),localStorage.setItem("usuario",JSON.stringify(t.data))}removeStorage(){localStorage.removeItem("token"),localStorage.removeItem("usuario"),localStorage.removeItem("urldebusqueda")}login(t){if(!this.API_URL)return null;let e=this.API_URL+"/login_check";return this.http.post(e,t).pipe(h(i=>{this.SaveStorage(i)}))}logout(){this.removeStorage(),this.router.navigateByUrl("/auth/login")}verificarCaducudadToken(){let t=localStorage.getItem("token");if(t){let e=JSON.parse(atob(t.split(".")[1]));if(this.expirado(e.exp)){console.log("LOGIN EXPIRADO"),this.logout();return}this.intervalID!==null&&(clearInterval(this.intervalID),this.intervalID=null),this.intervalID=setInterval(()=>{if(this.canDoSomething()){this.verificaRenueva(e.exp),clearInterval(this.intervalID),this.intervalID=null;return}},1e3)}}verificaRenueva(t){let e=new Date(t*1e3),i=new Date;i.setTime(i.getTime()+30*60*1e3),this.ejecutarRefresh&&e.getTime()<i.getTime()&&(this.ejecutarRefresh=!1,this.refreshToken().subscribe(s=>{this.ejecutarRefresh=!0},s=>{this.ejecutarRefresh=!0}))}expirado(t){let e=new Date().getTime()/1e3;return t<e}static{this.\u0275fac=function(e){return new(e||r)(n(l),n(f),n(g))}}static{this.\u0275prov=a({token:r,factory:r.\u0275fac,providedIn:"root"})}}return r})();export{o as a,c as b,g as c,L as d};
